import{d as $,u as H,a as J,r as n,s as W,o as X,c as a,b as e,l as j,t as i,i as v,v as b,O as L,f as I,g as Y,h as M,e as z,P as y,Q as Z,q as o}from"./index-eOxYirCB.js";const ee={class:"p-6"},se={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},le={class:"bg-white rounded-lg shadow p-6"},te={key:0,class:"flex justify-center py-8"},ae={key:1,class:"space-y-4"},oe={class:"flex items-center space-x-4 mb-6"},ne={class:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center"},re=["src","alt"],ue={key:1,class:"text-xl font-semibold text-gray-600"},de={class:"text-lg font-medium"},ie={class:"text-gray-600"},me={class:"text-sm text-gray-500"},ce={class:"space-y-4"},fe={class:"relative"},ve={class:"space-y-2"},be={class:"flex items-center justify-between p-3 bg-gray-50 rounded-md"},pe={class:"mt-1 p-3 bg-gray-50 rounded-md"},we={key:2,class:"text-center py-8 text-gray-500"},ye={class:"bg-white rounded-lg shadow p-6"},ge={key:0,class:"text-red-600 text-sm"},xe=["disabled"],he={key:0,class:"flex items-center"},_e={key:1},ke={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Pe={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ee={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ce={class:"sm:flex sm:items-start"},Ue={class:"w-full"},Ve={class:"mt-1 flex rounded-md shadow-sm"},je=["disabled"],Ie={key:0},Me={key:1},qe={key:2},De={key:0,class:"text-red-600 text-sm"},Ne={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Se=["disabled"],Te={key:0,class:"flex items-center"},Be={key:1},Ae=$({name:"ProfilePage",__name:"index",setup(Le){H();const{success:g,error:P}=J(),t=n(null),E=n(!1),r=n({oldPassword:"",newPassword:"",confirmPassword:""}),x=n(!1),p=n(""),u=n({newEmail:"",code:""}),h=n(!1),c=n(""),_=n(!1),f=n(0),k=n({username:!1}),m=n({username:""}),q=n(null),D=W(()=>u.value.newEmail&&u.value.newEmail.includes("@")&&f.value===0),A=l=>l?new Date(l).toLocaleString("zh-CN"):"",F=l=>{switch(l){case 1:return"超级管理员";case 2:return"管理员";case 3:return"普通用户";default:return"未知角色"}},G=l=>{switch(l){case 1:return"正常";case 2:return"禁用";case 3:return"已删除";default:return"未知状态"}},N=async()=>{try{E.value=!0;const l=await y.getUserInfo();t.value=l.data||l}catch(l){console.error("获取用户信息失败:",l),P("获取用户信息失败")}finally{E.value=!1}},K=async()=>{if(p.value="",r.value.newPassword!==r.value.confirmPassword){p.value="两次输入的新密码不一致";return}if(r.value.newPassword.length<6){p.value="新密码长度不能少于6位";return}try{x.value=!0,await y.changePassword({oldPassword:r.value.oldPassword,newPassword:r.value.newPassword}),g("密码修改成功"),r.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(l){console.error("修改密码失败:",l)}finally{x.value=!1}},C=n(!1),U=()=>{C.value=!1,u.value={newEmail:"",code:""},c.value=""},O=async()=>{if(D.value)try{_.value=!0,c.value="",await y.sendChangeEmailCode({email:u.value.newEmail}),g("验证码已发送"),Q()}catch(l){const s=l instanceof Error?l.message:"发送验证码失败";c.value=s,P(s)}finally{_.value=!1}},Q=()=>{f.value=60;const l=setInterval(()=>{f.value--,f.value<=0&&clearInterval(l)},1e3)},S=async()=>{if(c.value="",!u.value.newEmail||!u.value.code){c.value="请填写完整信息";return}try{h.value=!0,await y.updateProfile({email:u.value.newEmail,code:u.value.code}),g("邮箱修改成功"),await N(),U()}catch(l){const s=l instanceof Error?l.message:"修改邮箱失败";c.value=s}finally{h.value=!1}},R=async()=>{var l,s;k.value.username=!0,m.value.username=((l=t.value)==null?void 0:l.username)||"",await Z(),(s=q.value)==null||s.focus()},T=async()=>{var l,s;if(!m.value.username.trim()){P("用户名不能为空"),V();return}if(m.value.username===((l=t.value)==null?void 0:l.username)){V();return}try{await y.updateProfile({username:m.value.username}),t.value&&(t.value.username=m.value.username),g("用户名修改成功")}catch(w){console.error("修改用户名失败:",w),m.value.username=((s=t.value)==null?void 0:s.username)||""}finally{k.value.username=!1}},V=()=>{var l;k.value.username=!1,m.value.username=((l=t.value)==null?void 0:l.username)||""};return X(()=>{N()}),(l,s)=>{var B;const w=Y("GlobalIcon");return o(),a("div",ee,[s[22]||(s[22]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"个人信息"),e("p",{class:"mt-2 text-gray-600"},"查看和管理您的个人资料")],-1)),e("div",se,[e("div",le,[s[11]||(s[11]=e("h2",{class:"text-lg font-semibold mb-4"},"基本信息",-1)),E.value?(o(),a("div",te,s[7]||(s[7]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),e("p",{class:"ml-2"},"加载中...",-1)]))):t.value?(o(),a("div",ae,[e("div",oe,[e("div",ne,[t.value.avatar?(o(),a("img",{key:0,src:t.value.avatar,alt:t.value.username,class:"w-16 h-16 rounded-full object-cover"},null,8,re)):(o(),a("span",ue,i((B=t.value.username)==null?void 0:B.charAt(0).toUpperCase()),1))]),e("div",null,[e("h3",de,i(t.value.username),1),e("p",ie,i(t.value.email),1),e("p",me,i(F(t.value.role))+" • "+i(G(t.value.status)),1)])]),e("div",ce,[e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"用户名",-1)),e("div",fe,[k.value.username?v((o(),a("input",{key:0,ref_key:"usernameInput",ref:q,"onUpdate:modelValue":s[0]||(s[0]=d=>m.value.username=d),type:"text",class:"w-full px-3 py-2 border border-blue-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onBlur:T,onKeyup:[L(T,["enter"]),L(V,["escape"])]},null,544)),[[b,m.value.username]]):(o(),a("div",{key:1,class:"flex items-center justify-between p-3 bg-gray-50 rounded-md cursor-pointer hover:bg-gray-100 transition-colors",onClick:R},[e("span",null,i(t.value.username),1),I(w,{name:"pencil",size:"sm",class:"text-gray-400"})]))])]),e("div",null,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"邮箱",-1)),e("div",ve,[e("div",be,[e("span",null,i(t.value.email),1),e("button",{onClick:s[1]||(s[1]=d=>C.value=!0),class:"text-blue-600 hover:text-blue-700 text-sm"}," 修改邮箱 ")])])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"注册时间",-1)),e("div",pe,i(A(t.value.created_at)),1)])])])):(o(),a("div",we,"无法加载用户信息"))]),e("div",ye,[s[16]||(s[16]=e("h2",{class:"text-lg font-semibold mb-4"},"修改密码",-1)),e("form",{onSubmit:M(K,["prevent"]),class:"space-y-4"},[e("div",null,[s[12]||(s[12]=e("label",{for:"oldPassword",class:"block text-sm font-medium text-gray-700"}," 当前密码 ",-1)),v(e("input",{id:"oldPassword","onUpdate:modelValue":s[2]||(s[2]=d=>r.value.oldPassword=d),type:"password",required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入当前密码"},null,512),[[b,r.value.oldPassword]])]),e("div",null,[s[13]||(s[13]=e("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700"}," 新密码 ",-1)),v(e("input",{id:"newPassword","onUpdate:modelValue":s[3]||(s[3]=d=>r.value.newPassword=d),type:"password",required:"",minlength:"6",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入新密码（至少6位）"},null,512),[[b,r.value.newPassword]])]),e("div",null,[s[14]||(s[14]=e("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700"}," 确认新密码 ",-1)),v(e("input",{id:"confirmPassword","onUpdate:modelValue":s[4]||(s[4]=d=>r.value.confirmPassword=d),type:"password",required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请再次输入新密码"},null,512),[[b,r.value.confirmPassword]])]),p.value?(o(),a("div",ge,i(p.value),1)):j("",!0),e("button",{type:"submit",disabled:x.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[x.value?(o(),a("span",he,[I(w,{name:"arrow-path",class:"animate-spin -ml-1 mr-3 h-5 w-5"}),s[15]||(s[15]=z(" 修改中... "))])):(o(),a("span",_e,"修改密码"))],8,xe)],32)])]),C.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:M(U,["self"])},[e("div",ke,[s[21]||(s[21]=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),e("div",Pe,[e("div",Ee,[e("div",Ce,[e("div",Ue,[s[19]||(s[19]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"}," 修改邮箱 ",-1)),e("form",{onSubmit:M(S,["prevent"]),class:"space-y-4"},[e("div",null,[s[17]||(s[17]=e("label",{for:"newEmail",class:"block text-sm font-medium text-gray-700"}," 新邮箱 ",-1)),v(e("input",{id:"newEmail","onUpdate:modelValue":s[5]||(s[5]=d=>u.value.newEmail=d),type:"email",required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入新邮箱地址"},null,512),[[b,u.value.newEmail]])]),e("div",null,[s[18]||(s[18]=e("label",{for:"emailCode",class:"block text-sm font-medium text-gray-700"}," 验证码 ",-1)),e("div",Ve,[v(e("input",{id:"emailCode","onUpdate:modelValue":s[6]||(s[6]=d=>u.value.code=d),type:"text",required:"",maxlength:"6",class:"flex-1 block w-full px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"请输入6位验证码"},null,512),[[b,u.value.code]]),e("button",{type:"button",disabled:!D.value||_.value,onClick:O,class:"inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-500 text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"},[_.value?(o(),a("span",Ie,"发送中...")):f.value>0?(o(),a("span",Me,i(f.value)+"s",1)):(o(),a("span",qe,"发送验证码"))],8,je)])]),c.value?(o(),a("div",De,i(c.value),1)):j("",!0)],32)])])]),e("div",Ne,[e("button",{onClick:S,disabled:h.value,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[h.value?(o(),a("span",Te,[I(w,{name:"arrow-path",class:"animate-spin -ml-1 mr-2 h-4 w-4"}),s[20]||(s[20]=z(" 修改中... "))])):(o(),a("span",Be,"确认修改"))],8,Se),e("button",{onClick:U,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," 取消 ")])])])])):j("",!0)])}}});export{Ae as default};
