import{d as R,u as S,a as T,i as m,j as k,m as j,c as d,b as e,n as y,f as g,e as r,p as z,t as b,z as D,q as I,s as w,v as x,h as P,w as A,r as $,y as F,o as i}from"./index-BYj9fpU8.js";const H={class:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},L={class:"max-w-md w-full space-y-8"},G={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},J={class:"flex"},K={class:"flex-shrink-0"},O={class:"ml-3"},Q={class:"text-red-800"},W={key:1,class:"bg-green-50 border border-green-200 rounded-md p-4"},X={class:"flex"},Y={class:"flex-shrink-0"},Z={class:"ml-3"},ee={class:"text-green-800"},se={class:"space-y-4"},te=["disabled"],oe={class:"mt-1 flex space-x-2"},le=["disabled"],re=["disabled"],ae={key:0},ne={key:1},de={key:2},ie=["disabled"],ue=["disabled"],ce=["disabled"],me={key:0,class:"absolute left-0 inset-y-0 flex items-center pl-3"},ve={class:"text-center"},be=R({__name:"index",setup(fe){const C=F(),{resetPassword:V,sendResetPasswordCode:M,loading:a}=S(),{success:_,error:h}=T(),t=m({email:"",code:"",newPassword:"",confirmPassword:""}),o=m(""),v=m(""),f=m(!1),u=m(0);let c=null;const p=k(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value.email)),q=k(()=>t.value.email.trim()!==""&&t.value.code.trim()!==""&&t.value.newPassword.trim()!==""&&t.value.confirmPassword.trim()!==""&&t.value.newPassword===t.value.confirmPassword&&p.value),B=async()=>{try{if(o.value="",!t.value.email.trim()){o.value="请输入邮箱地址";return}if(!p.value){o.value="请输入有效的邮箱地址";return}f.value=!0,await M(t.value.email.trim()),_("验证码已发送到您的邮箱"),E()}catch(l){const s=l instanceof Error?l.message:"发送验证码失败";o.value=s,h(s)}finally{f.value=!1}},E=()=>{u.value=60,c=setInterval(()=>{u.value--,u.value<=0&&(clearInterval(c),c=null)},1e3)},U=async()=>{try{if(o.value="",v.value="",!t.value.email.trim()){o.value="请输入邮箱地址";return}if(!p.value){o.value="请输入有效的邮箱地址";return}if(!t.value.code.trim()){o.value="请输入验证码";return}if(!t.value.newPassword.trim()){o.value="请输入新密码";return}if(t.value.newPassword.length<6){o.value="密码长度不能少于6位";return}if(t.value.newPassword!==t.value.confirmPassword){o.value="两次输入的密码不一致";return}const l={email:t.value.email.trim(),code:t.value.code.trim(),newPassword:t.value.newPassword.trim()};await V(l),v.value="密码重置成功！请使用新密码登录",_("密码重置成功！"),setTimeout(()=>{C.push("/login")},2e3)}catch(l){const s=l instanceof Error?l.message:"重置密码失败，请重试";o.value=s,h(s)}};return j(()=>{c&&clearInterval(c)}),(l,s)=>{const N=$("router-link");return i(),d("div",H,[e("div",L,[s[10]||(s[10]=e("div",null,[e("h2",{class:"mt-6 text-center text-3xl font-extrabold text-gray-900"}," 重置密码 "),e("p",{class:"mt-2 text-center text-sm text-gray-600"}," 输入您的邮箱地址和验证码，设置新密码 ")],-1)),o.value?(i(),d("div",G,[e("div",J,[e("div",K,[g(r(z),{class:"h-5 w-5 text-red-400"})]),e("div",O,[e("p",Q,b(o.value),1)])])])):y("",!0),v.value?(i(),d("div",W,[e("div",X,[e("div",Y,[g(r(D),{class:"h-5 w-5 text-green-400"})]),e("div",Z,[e("p",ee,b(v.value),1)])])])):y("",!0),e("form",{class:"mt-8 space-y-6",onSubmit:I(U,["prevent"])},[e("div",se,[e("div",null,[s[4]||(s[4]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"邮箱地址",-1)),w(e("input",{id:"email","onUpdate:modelValue":s[0]||(s[0]=n=>t.value.email=n),type:"email",required:"",disabled:r(a),class:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"请输入您的邮箱"},null,8,te),[[x,t.value.email]])]),e("div",null,[s[5]||(s[5]=e("label",{for:"code",class:"block text-sm font-medium text-gray-700"},"验证码",-1)),e("div",oe,[w(e("input",{id:"code","onUpdate:modelValue":s[1]||(s[1]=n=>t.value.code=n),type:"text",required:"",disabled:r(a),class:"flex-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"请输入验证码"},null,8,le),[[x,t.value.code]]),e("button",{type:"button",disabled:f.value||u.value>0||!p.value,onClick:B,class:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[f.value?(i(),d("span",ae,"发送中...")):u.value>0?(i(),d("span",ne,b(u.value)+"s",1)):(i(),d("span",de,"发送验证码"))],8,re)])]),e("div",null,[s[6]||(s[6]=e("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700"},"新密码",-1)),w(e("input",{id:"newPassword","onUpdate:modelValue":s[2]||(s[2]=n=>t.value.newPassword=n),type:"password",required:"",disabled:r(a),class:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"请输入新密码"},null,8,ie),[[x,t.value.newPassword]])]),e("div",null,[s[7]||(s[7]=e("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700"},"确认新密码",-1)),w(e("input",{id:"confirmPassword","onUpdate:modelValue":s[3]||(s[3]=n=>t.value.confirmPassword=n),type:"password",required:"",disabled:r(a),class:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"请再次输入新密码"},null,8,ue),[[x,t.value.confirmPassword]])])]),e("div",null,[e("button",{type:"submit",disabled:r(a)||!q.value,class:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[r(a)?(i(),d("span",me,s[8]||(s[8]=[e("svg",{class:"animate-spin h-5 w-5 text-blue-300",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),P(" "+b(r(a)?"重置中...":"重置密码"),1)],8,ce)]),e("div",ve,[g(N,{to:"/login",class:"font-medium text-blue-600 hover:text-blue-500"},{default:A(()=>s[9]||(s[9]=[P(" 返回登录 ")])),_:1,__:[9]})])],32)])])}}});export{be as default};
